!function(e){e.fn.transpose=function(a){var n=e.extend({},e.fn.transpose.defaults,a),t=null,s=[{name:"Ab",value:0,type:"F"},{name:"A",value:1,type:"N"},{name:"A#",value:2,type:"S"},{name:"Bb",value:2,type:"F"},{name:"B",value:3,type:"N"},{name:"C",value:4,type:"N"},{name:"C#",value:5,type:"S"},{name:"Db",value:5,type:"F"},{name:"D",value:6,type:"N"},{name:"D#",value:7,type:"S"},{name:"Eb",value:7,type:"F"},{name:"E",value:8,type:"N"},{name:"F",value:9,type:"N"},{name:"F#",value:10,type:"S"},{name:"Gb",value:10,type:"F"},{name:"G",value:11,type:"N"},{name:"G#",value:0,type:"S"}],u=function(e){"m"==e.charAt(e.length-1)&&(e=e.substring(0,e.length-1));for(var a=0;a<s.length;a++)if(e==s[a].name)return s[a]},r=function(e,a,n){var t=u(e).value+a;t>11?t-=12:t<0&&(t+=12);var r=0;if(0==t||2==t||5==t||7==t||10==t)switch(n.name){case"A":case"A#":case"B":case"C":case"C#":case"D":case"D#":case"E":case"F#":case"G":case"G#":for(;r<s.length;r++)if(s[r].value==t&&"S"==s[r].type)return s[r];default:for(;r<s.length;r++)if(s[r].value==t&&"F"==s[r].type)return s[r]}else for(;r<s.length;r++)if(s[r].value==t)return s[r]},l=function(a,n){var s=u(n);if(t.name!=s.name){var r,l,c=(r=t.value,r>(l=s.value)?0-(r-l):r<l?0+(l-r):0);e("span.c",a).each(function(e,a){m(a,c,s)}),t=s}},m=function(a,n,t){var s,u=e(a),l=u.text(),m=(s=l).length>1&&("b"==s.charAt(1)||"#"==s.charAt(1))?s.substr(0,2):s.substr(0,1),h=r(m,n,t).name+l.substr(m.length);u.text(h);var p=u[0].nextSibling;if(p&&3==p.nodeType&&p.nodeValue.length>0&&"/"!=p.nodeValue.charAt(0)){var v=c(l.length,h.length,p.nodeValue.length);p.nodeValue=i(" ",v)}},c=function(e,a,n){return e>a?n+(e-a):e<a?n-(a-e):n},i=function(e,a){for(var n=[],t=0;t<a;t++)n.push(e);return n.join("")},h=function(a){for(var t=a.replace(/\s+/," ").split(" "),s=0;s<t.length;s++)if(0==!e.trim(t[s]).length&&!t[s].match(n.chordRegex))return!1;return!0};return e(this).each(function(){var a,r=e(this).attr("data-key");if(r&&""!=e.trim(r)||(r=n.key),!r||""==e.trim(r))throw"Starting key not defined.";t=u(r);var m=[];e(s).each(function(e,a){t.name==a.name?m.push("<a href='#' class='selected'>"+a.name+"</a>"):m.push("<a href='#'>"+a.name+"</a>")});var c=e(this),i=e("<div class='transpose-keys'></div>");i.html(m.join("")),e("a",i).click(function(a){return a.preventDefault(),l(c,e(this).text()),e(".transpose-keys a").removeClass("selected"),e(this).addClass("selected"),!1}),e(this).before(i);for(var p,v=[],o=e(this).text().split(/\r\n|\n/g),f=0;f<o.length;f++)h(p=o[f])?v.push("<span>"+(a=p).replace(n.chordReplaceRegex,"<span class='c'>$1</span>")+"</span>"):v.push("<span>"+p+"</span>");e(this).html(v.join("\n"))})},e.fn.transpose.defaults={chordRegex:/^[A-G][b\#]?(2|4|5|6|7|9|11|13|6\/9|7\-5|7\-9|7\#5|7\#9|7\+5|7\+9|b5|#5|#9|7b5|7b9|7sus2|7sus4|add2|add4|add9|aug|dim|dim7|m\/maj7|m6|m7|m7b5|m9|m11|m13|maj7|maj9|maj11|maj13|mb5|m|sus|sus2|sus4)*(\/[A-G][b\#]*)*$/,chordReplaceRegex:/([A-G][b\#]?(2|4|5|6|7|9|11|13|6\/9|7\-5|7\-9|7\#5|7\#9|7\+5|7\+9|b5|#5|#9|7b5|7b9|7sus2|7sus4|add2|add4|add9|aug|dim|dim7|m\/maj7|m6|m7|m7b5|m9|m11|m13|maj7|maj9|maj11|maj13|mb5|m|sus|sus2|sus4)*)/g}}(jQuery);
